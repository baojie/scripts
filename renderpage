#!/usr/bin/env phantomjs
var system = require('system');
var webpage = require('webpage');
var fs = require('fs');

var url = system.args[1];

var filename = url.replace(/^https?/, '').replace(/\//g, '-').replace(/\W/g, '') + '.png';

var page = webpage.create();
page.viewportSize = { width: 800, height: 800 };

console.log('Opening url: ' + url);
page.open(url, function(status) {
  if (status !== 'success') {
    console.error('Unable to load the address!');
  }

  var document_dimensions = page.evaluate(function() {
    return {width: document.width, height: document.height};
  });
  console.log('Dimensions: ' + document_dimensions.width + 'x' + document_dimensions.height);

  page.viewportSize = document_dimensions;

  // window.setTimeout(function () { }, 200);
  console.log('Saving to: ' + filename);
  page.render(filename);
  phantom.exit();
});
